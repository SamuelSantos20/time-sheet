services:
  postgres-workbench:
    image: dpage/pgadmin4:latest
    container_name: postgres-workbench
    env_file:
      - .env # Variáveis de ambiente externas
    environment:
      - PGADMIN_DEFAULT_EMAIL=samuelfamilia@gmail.com # Email padrão para login no pgAdmin
      - PGADMIN_DEFAULT_PASSWORD=admin
      - TZ=America/Sao_Paulo # Fuso horário local
    ports:
      - '5050:80' # Porta para acessar o pgAdmin no navegador
    volumes:
      - ./pgadmin-data:/var/lib/pgadmin # Persistência de dados do Workbench
    networks:
      - time-sheet-network
    restart: unless-stopped

  postgres-database:   
    image: postgres:latest
    container_name: postgres-database
    env_file:
      - .env # Variáveis de ambiente externas
    environment:
      - TZ=America/Sao_Paulo # Fuso horário local
    ports:
      - '5432:5432' # Porta padrão do PostgreSQL
    volumes:
      - ./pgdata:/var/lib/postgresql/data # Persistência de dados do banco
    networks:
      - time-sheet-network
    restart: unless-stopped


  # Spring Boot Application
  app:
    build:
      context: .
      dockerfile: Dockerfile
    image: time-sheet-spring
    container_name: spring-time-sheet
    command: mvn test

    environment:
      - SPRING_DATASOURCE_URL
      - SPRING_DATASOURCE_USERNAME
      - SPRING_DATASOURCE_PASSWORD
      - SPRING_DATASOURCE_DRIVER_CLASS_NAME
      - SPRING_JPA_HIBERNATE_DDL_AUTO
      - SPRING_JPA_DATABASE_PLATFORM
      - SPRING_JPA_SHOW_SQL
      - SPRING_JPA_PROPERTIES_HIBERNATE_FORMAT_SQL
      - LOGGING_LEVEL_ROOT
      - LOGGING_FILE_NAME
    ports:
      - "9090:8080"
    volumes:
      - ./logs:/logs
    networks:
      - time-sheet-network

networks:
  time-sheet-network:
    driver: bridge
